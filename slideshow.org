#    -*- mode: org -*-
#+OPTIONS: num:nil
#+OPTIONS: toc:nil
#+Title: Rails and Phoenix Side-by-Side
#+Author: Scott Smith (OldFartDeveloper)
#+Email: scottnelsonsmith@gmail.com

* Introduction

- Tonight:

  - Introduce *Elixir* / *Phoenix*

  - Use scaffolding to generate almost identical web apps in:
    - Rails
    - Phoenix

  - Web Sockets/Channels
    - Interaction between Phoenix and Javascript
    - A chat app

  - Questions

* Elixir / Phoenix

  - Elixir :: A syntactically-rich functional language that transpiles to Erlang,
              a mature ultra-reliable language and library that's been developed
              ove the last 30 years.
  - Phoenix :: A web framework implemented in Elixir and patterned liked Rails.

** Elixir

    - Syntax is not Ruby but feels like it.
    - Like Ruby, has powerful metaprogramming capability.

** Phoenix

  - Patterned after Rails
    - Model/View/Controller
    - Migrations
    - Scaffolding
    - Console

** Erlang

  - Highly evolved language/framework for challenging concurrancy applications
    that have to be reliable
  - Mechanisms to handle failures of /just about anything/
  - Not going to cover here

* Scaffold Generate Same App in Rails and Phoenix

1. Generate Rails and Phoenix "starter" apps side by side

1. Measure both for performance

1. Generate 'user' CRUD both on *Postgresql*

1. Measure both for performance

** Commands to Generate "starter" apps

#+ATTR_HTML: :width 100%

| Purpose           | Rails                             | Phoenix                     |
|-------------------+-----------------------------------+-----------------------------|
| Language Install  | brew install ruby                 | brew install elixir         |
| Pkg Mgr           |                                   | mix local.hex               |
| Framework Install | gem install rails                 | mix archive install phoenix |
| Create App        | rails new -d postgresql demorails | mix phoenix.new demophoenix |
| Create Database   | rake db:create; rake db:migrate   | createdb demophoenix_dev    |
| Run App           | rails server                      | mix phoenix.server          |
| Browse URL        | localhost:3000                    | localhost:4000              |


*** Minor Elixir Basic Fixes

- The scaffold generators haven't yet been updated yet.

- [[https://gist.github.com/chrismccord/57805158f463d3369103][Phoenix Upgrade Instructions 0.13.x 0.14.0]]

#+BEGIN_SRC
cd web/templates/layout
mv application.html.eex app.html.eex
#+END_SRC

** Measure "starter" Apps Performance

#+ATTR_HTML: :width 100%
|             | demorails                            | demophoenix                          |
|-------------+--------------------------------------+--------------------------------------|
| cmd         | weighttp -n 1000 -c 4 localhost:3000 | weighttp -n 1000 -c 4 localhost:4000 |
| req/s       | 192                                  | 291                                  |
| finished/s  | 5.206                                | 3.429                                |
| kbyte/s     | 2885                                 | 654                                  |
| total bytes | 15,385,000                           | 2,299,000                            |
| http bytes  | 450,000                              | 205,000                              |
| data bytes  | 14,935,000                           | 2,094,000                            |


** Generate 'user' CRUD Enhancement

#+ATTR_HTML: :width 100%
| App         | Command to Generate User w/ email and password               |
|-------------+--------------------------------------------------------------|
| demorails   | rails generate scaffold User email:string password:string    |
| demorails   | rails server                                                 |
| demophoenix | mix phoenix.gen.html User users email:string password:string |
| demophoenix | mix ecto.migrate                                             |
| demophoenix | mix phoenix.server                                           |

** Measure Performance w/ Database

#+ATTR_HTML: :width 100%
|             | demorails                                  | demophoenix                                |
|-------------+--------------------------------------------+--------------------------------------------|
| cmd         | weighttp -n 1000 -c 4 localhost:3000/users | weighttp -n 1000 -c 4 localhost:4000/users |
| req/s       | 28                                         | 68                                         |
| finished/s  | 34.956                                     | 14.599                                     |
| kbyte/s     | 79                                         | 140                                        |
| total bytes | 2,862,000                                  | 2,099,000                                  |
| http bytes  | 786,000                                    | 352,000                                    |
| data bytes  | 2,076,000                                  | 1,747,000                                  |

* Demonstrate Web Sockets/Channels in Chat App
** Demonstrate Chat App
- Demo

#+BEGIN_NOTES
Some speaker notes
#+END_NOTES

** The Elixir Channel
** The Javascript Client
* Questions
* Play Area

Nice org mode commands from Forrest.  Just type them as /less-than/ then one of:

  - 's' for code blocks ("source" code)
  - 'q' for quote
  - 'h' for html block

then /tab/
** Try Quote
#+BEGIN_QUOTE
Everything should be made as simple as possible,
     but not any simpler -- Albert Einstein
#+END_QUOTE
And let's see what that does.
** Try HTML
#+BEGIN_HTML
<h3>A header</h3>
<p>Here is a paragraph</p>
#+END_HTML
** Try src
#+BEGIN_SRC ruby
def bun
  # do something
end
#+END_SRC
